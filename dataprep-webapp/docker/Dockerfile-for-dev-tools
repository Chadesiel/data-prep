FROM node:5.12.0

#update the apt-get packages
RUN apt-get update

#fix locales to be UTF-8
RUN apt-get -y install locales
RUN locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8

# add jenkins user (needs to match the <docker.user> value passed to the jenkins job)
RUN adduser --disabled-password --uid=498 --gecos '' jenkins

# add dev user for tests default value in pom.xml
RUN adduser --disabled-password --uid=1000 --gecos '' dp_dev

#config npm
COPY ./.npmrc /home/jenkins/.npmrc
RUN chown 498 /home/jenkins/.npmrc
COPY ./.npmrc /home/dp_dev/.npmrc
RUN chown 1000 /home/dp_dev/.npmrc

RUN mkdir /home/jenkins/.npm
RUN chown 498 /home/jenkins/.npm
RUN echo 'npm config set prefix "/home/jenkins/.npm"; export PATH=/home/jenkins/.npm/bin:$PATH' >> /home/jenkins/.profile

RUN mkdir /home/dp_dev/.npm
RUN chown 1000 /home/dp_dev/.npm
RUN echo 'npm config set prefix "/home/dp_dev/.npm"; export PATH=/home/dp_dev/.npm/bin:$PATH' >> /home/dp_dev/.profile

WORKDIR /data-prep

CMD ["bash"]
