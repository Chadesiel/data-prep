<div class="inventory dataset">
    <div class="inventory-sort">
        <div class="add-folder-button">
            <button class="btn-primary modal-primary-button" ng-click="datasetListCtrl.actionsOnAddFolderClick()">
                <span translate-once="CREATE_FOLDER"></span>
            </button>
        </div>
        <div translate-once="SORTED_BY"></div>
        <div class="button-switch">
            <talend-button-switch
                    values="datasetListCtrl.sortList"
                    current-value="datasetListCtrl.sortSelected"
                    display-key="name"
                    change-action="datasetListCtrl.updateSortBy(selected)">
            </talend-button-switch>
        </div>
        <div translate-once="SORT_IN"> </div>
        <div class="button-switch">
            <talend-button-switch
                    values="datasetListCtrl.orderList"
                    current-value="datasetListCtrl.sortOrderSelected"
                    display-key="name"
                    change-action="datasetListCtrl.updateSortOrder(selected)">
            </talend-button-switch>
        </div>
        <div translate-once="SORT_ORDER"></div>
    </div>

    <div class="inventory-list" id="datasets-list">
        <div class="inventory-entry" ng-repeat="child in datasetListCtrl.currentFolderContent.folders">
          <div class="inventory-icon inventory-folder" ng-click="datasetListCtrl.goToFolder(child)">
              <img src="assets/images/folder/folder-icon.png"/>
          </div>
          <div class="inventory-text inventory-folder">
              <talend-editable-text text="child.name"
                                    text-class="inventory-title"
                                    on-text-click="datasetListCtrl.goToFolder(child)"
                                    on-validate="datasetListCtrl.renameFolder(child.id, text)"></talend-editable-text>
          </div>
        </div>

        <div class="inventory-entry" ng-repeat="dataset in datasetListCtrl.currentFolderContent.datasets track by $index" ng-switch="dataset.draft" id="dataset_{{$index}}">

            <div class="inventory-icon"
                 translate-once-title="OPEN_ACTION"
                 translate-values="{type: 'dataset', name: dataset.name}"
                 ng-switch="dataset.type"
                 ng-click="datasetListCtrl.uploadWorkflowService.openDataset(dataset)">
                <img src="/assets/images/inventory/csv_file.png" ng-switch-when="text/csv"/>
                <img src="/assets/images/inventory/xls_file.png" ng-switch-when="application/vnd.ms-excel"/>
                <img src="/assets/images/inventory/generic_file.png" ng-switch-default/>
                <img ng-src="/assets/images/certification-{{dataset.certificationStep | lowercase}}.png"
                     class="pin"
                     ng-if="dataset.certificationStep!='NONE'"/>
            </div>

            <div class="inventory-text">
                <talend-editable-text text="dataset.name"
                                      text-class="inventory-title"
                                      text-title="{{ 'OPEN_ACTION' | translate: {type: 'dataset', name: dataset.name} }}"
                                      on-text-click="datasetListCtrl.uploadWorkflowService.openDataset(dataset)"
                                      on-validate="datasetListCtrl.rename(dataset, text)"></talend-editable-text>
                <div class="inventory-description" translate-once="INVENTORY_DETAILS" translate-values="dataset"></div>
            </div>

            <!-- Draft actions icons -->
            <div ng-switch-when="true"
                 class="inventory-actions">
                <a data-icon="e"
                   class="btn-icon btn-transparent"
                   translate-once-title="DELETE_ACTION"
                   translate-values="{type: 'dataset', name: dataset.name}"
                   ng-click="datasetListCtrl.delete(dataset)"></a>
            </div>

            <!-- Not draft actions icons -->
            <div ng-switch-when="false" class="inventory-actions">
                <a data-icon="c"
                   class="btn-icon btn-transparent"
                   ng-if="!!dataset.defaultPreparation"
                   translate-once-title="OPEN_ACTION"
                   translate-values="{type: 'preparation', name: dataset.defaultPreparation.name}"
                   ui-sref="nav.home.preparations({prepid: dataset.defaultPreparation.id})"></a>

                <talend-file-selector
                        button-data-icon="E"
                        button-title="REPLACE_FILE_CONTENT"
                        file-model="datasetListCtrl.updateDatasetFile"
                        on-file-change="datasetListCtrl.uploadUpdatedDatasetFile(dataset)">
                </talend-file-selector>

                <a data-icon="h" class="btn-icon btn-transparent"></a>

                <div class="divider btn-transparent"></div>

                <a data-icon="B"
                   class="btn-icon btn-transparent"
                   translate-once-title="CLONE_ACTION"
                   translate-values="{type: 'dataset', name: dataset.name}"
                   ng-click="datasetListCtrl.openFolderChoice(dataset)"></a>

                <a data-icon="e"
                   class="btn-icon btn-transparent"
                   translate-once-title="DELETE_ACTION"
                   translate-values="{type: 'dataset', name: dataset.name}"
                   ng-click="datasetListCtrl.delete(dataset)"></a>

                <div class="divider btn-transparent"></div>
                <a data-icon="s"
                   class="btn-icon btn-transparent"
                   translate-once-title="CERTIFY_ACTION"
                   translate-values="{type: 'dataset', name: dataset.name}"
                   ng-click="datasetListCtrl.processCertification(dataset)"></a>
                <a data-icon="f"
                   class="btn-icon btn-transparent favorite"
                   translate-once-title="FAVORITE_ACTION"
                   translate-values="{type: 'dataset', name: dataset.name}"
                   ng-class="{'favorite-true':dataset.favorite}"
                   ng-click="datasetListCtrl.datasetService.toggleFavorite(dataset)"></a>
            </div>
        </div>
    </div>

    <talend-modal fullscreen="false"
                  close-button="true"
                  state="datasetListCtrl.folderNameModal">
        <span translate-once="ENTER_FOLDER_NAME"></span>
        <form name="datasetListCtrl.folderNameForm" ng-submit="datasetListCtrl.folderNameForm.$valid && datasetListCtrl.addFolder()">
            <input type="text"
                   ng-model="datasetListCtrl.folderName"
                   ng-model-options="{debounce: { default: 300, blur: 0 }}"
                   unique-folder="datasetListCtrl.currentFolderContent.folders"/>

            <div class="modal-buttons">
                <button type="button" class="talend-modal-close btn-secondary modal-secondary-button" translate-once="CANCEL">
                </button>
                <button class="btn-primary modal-primary-button" translate-once="OK"
                        ng-disabled="datasetListCtrl.folderNameForm.$invalid">
                </button>
            </div>
        </form>
    </talend-modal>


    <talend-modal fullscreen="false"
                  close-button="true"
                  state="datasetListCtrl.folderDestinationModal">

        <div class="modal-title" translate-once="CHOOSE_FOLDER_DESTINATION" translate-values="{type: 'dataset', name: dataset.name}">
        </div>
        <div class="modal-body">
            <div class="folders-modal">
                    <form class="search-bar" id="search-folder-form">
                        <input type="search" ng-model="datasetListCtrl.searchFolderQuery"  translate-once-placeholder="FIND_FOLDER"/>
                        <button type="submit" ng-click="datasetListCtrl.searchFolders()">
                            <img src="assets/images/folder/search-icon.png">
                        </button>
                    </form>

                <div class="folders">
                    <script type="text/ng-template" id="basic_renderer.html">
                        <div ui-tree-handle class="folder-node tree-node"
                             ng-class="{folderselected: node.selected}">
                            <a class="inventory-icon inventory-folder nodrop" data-nodrag ng-click="datasetListCtrl.toggle(node)"
                               ng-class="{'dropdown-button-right': node.collapsed, 'dropdown-button-down': !node.collapsed}">
                                <img ng-if="!node.collapsed" src="assets/images/folder/folder_open_small-icon.png"/>
                                <img ng-if="node.collapsed" src="assets/images/folder/folder_close_small-icon.png"/>
                            </a>
                            <span ng-click="datasetListCtrl.chooseFolder(node)" class="folder-name">{{node.name}}</span>
                        </div>
                        <ol ui-tree-nodes ng-model="node.nodes" ng-class="{hidden: node.collapsed}">
                            <li ng-repeat="node in node.nodes" ui-tree-node ng-include="'basic_renderer.html'"></li>
                        </ol>
                    </script>

                    <div ng-if="datasetListCtrl.displayFoldersList">
                        <ul class="folders-list">
                            <li ng-repeat="node in datasetListCtrl.foldersFound"
                                ng-class="{folderselected: node.selected}">
                                <span ng-click="datasetListCtrl.chooseFolder(node)" class="folder-name">{{node.path}}</span>
                            </li>
                        </ul>
                    </div>

                    <div ui-tree id="tree-root" data-nodrop-enabled="true" ng-if="!datasetListCtrl.displayFoldersList">
                      <ol ui-tree-nodes ng-model="datasetListCtrl.folders">
                        <li ng-repeat="node in datasetListCtrl.folders" ui-tree-node ng-include="'basic_renderer.html'"></li>
                      </ol>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="talend-modal-close btn-secondary modal-secondary-button" translate-once="CANCEL">
                        </button>
                        <button class="btn-primary modal-primary-button" translate-once="COPY_ACTION" ng-click="datasetListCtrl.clone()">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </talend-modal>

</div>


