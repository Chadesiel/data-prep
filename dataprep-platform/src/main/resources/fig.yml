mongodb:
    image: dockerfile/mongodb
    volumes:
        - runtime/mongodb:/data/db
    ports:
        - "27017:27017"
nginx:
    image: jwilder/nginx-proxy
    volumes:
        - /var/run/docker.sock:/tmp/docker.sock
    ports:
        - "80:80"
api:
    image: talend/dataprep-api:1.0.m0-SNAPSHOT
    expose:
        - 8888
    links:
        - transform
        - dataset
    environment:
        TDP_API_SERVER_PORT: 8888
        TDP_API_DATASET_SERVICE_URL: http://${DATASET_PORT_8080_TCP_ADDR}:${DATASET_PORT_8080_TCP_PORT}/datasets
        TDP_API_TRANSFORMATION_SERVICE_URL: http://${TRANSFORM_PORT_8180_TCP_ADDR}:${TRANSFORM_1_PORT_8180_TCP_PORT}/transform
        VIRTUAL_HOST: api.tdp.talend.lan
        VIRTUAL_PORT: 8888
transform:
    image: talend/dataprep-transformation:1.0.m0-SNAPSHOT
    volumes:
        - runtime/dataset/store:/store
    expose:
        - 8180
    environment:
        TDP_TRANSFORMATION_SERVER_PORT: 8180
        VIRTUAL_HOST: transformation.tdp.talend.lan
        VIRTUAL_PORT: 8180
dataset:
    image: talend/dataprep-dataset:1.0.m0-SNAPSHOT
    volumes:
        - runtime/dataset/store:/store
    expose:
        - 8080
    links:
        - mongodb
    environment:
        TDP_DATASET_SERVER_PORT: 8080
        TDP_DATASET_METADATA_STORE: mongodb
        TDP_DATASET_CONTENT_STORE: local
        TDP_DATASET_CONTENT_STORE_LOCAL_LOCATION: /store
        TDP_DATASET_MONGODB_HOST: ${MONGODB_PORT_27017_TCP_ADDR}
        TDP_DATASET_MONGODB_PORT: ${MONGODB_PORT_27017_TCP_PORT}
        VIRTUAL_HOST: dataset.tdp.talend.lan
        VIRTUAL_PORT: 8080